<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GloseMester</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icon.png">
    
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/kort.css">
    <link rel="stylesheet" href="css/popups.css">
    
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
</head>
<body>

    <div id="landing-page" class="page active">
        <header style="text-align:center; padding: 40px 20px;">
            <h1 style="font-size: 3rem; margin-bottom: 10px;">GloseMester üéÆ</h1>
            <p style="color:#666; max-width:500px; margin: 10px auto;">
                Samle kort, bygg din samling og l√¶r spr√•k samtidig.
            </p>
        </header>

        <div class="role-grid">
            <div class="role-card" onclick="velgRolle('oving')">
                <span class="role-icon">üí™</span>
                <h3>√òv Selv</h3>
                <p>Velg trinn og samle kort</p>
            </div>
            
            <div class="role-card" onclick="velgRolle('kode')">
                <span class="role-icon">üéì</span>
                <h3>Har Kode</h3>
                <p>Ta pr√∏ve fra l√¶rer</p>
            </div>
            
            <div class="role-card" onclick="velgRolle('laerer')">
                <span class="role-icon">üçé</span>
                <h3>L√¶rer</h3>
                <p>Lag pr√∏ver</p>
            </div>
        </div>
        
        <div style="text-align:center; margin-top:40px;">
            <button class="btn-secondary" onclick="document.getElementById('info-modal').style.display='flex'">
                ‚ÑπÔ∏è Om oss & Priser
            </button>
        </div>
    </div>

    <nav id="elev-meny" style="display:none;">
        <button id="btn-elev-dashboard" onclick="visSide('elev-dashboard')">Hjem</button>
        <button id="btn-elev-samling" onclick="visSide('elev-samling')">Samling</button>
        <button class="btn-danger" onclick="tilbakeTilStart()">Logg ut</button>
    </nav>

    <nav id="oving-meny" style="display:none;">
        <button id="btn-oving-start" onclick="visSide('oving-start')">√òv</button>
        <button id="btn-oving-samling" onclick="visSide('oving-samling')">Samling</button>
        <button class="btn-danger" onclick="tilbakeTilStart()">Avslutt</button>
    </nav>

    <nav id="laerer-meny" style="display:none;">
        <button id="btn-laerer-dashboard" class="active">Dashboard</button>
        <button class="btn-danger" onclick="tilbakeTilStart()">Logg ut</button>
    </nav>
    
    <div id="elev-dashboard" class="page">
        <div class="card-container" id="elev-start-skjerm">
            <h2>Klar for pr√∏ve?</h2>
            <p>Skriv inn koden du fikk av l√¶reren, eller skann QR.</p>
            
            <input type="text" id="prove-kode" placeholder="F.eks: ABC-123">
            <div style="display:flex; gap:10px; justify-content:center; margin-top:10px;">
                <button class="btn-primary" onclick="startProve()">Start Pr√∏ve</button>
                <button class="btn-secondary" onclick="startQRScanner()">üì∑ Skann QR</button>
            </div>
        </div>
        
        <div id="prove-omraade" class="card-container" style="display:none;">
            <div style="display:flex; justify-content:space-between;">
                <h3>Pr√∏ve</h3>
                <span id="quiz-progress">1/10</span>
            </div>
            <h1 id="quiz-spm" style="text-align:center; margin: 30px 0; font-size:32px;">...</h1>
            
            <input type="text" id="quiz-input" placeholder="Svar her...">
            <button class="btn-primary" onclick="sjekkSvar()">Svar</button>
            <button class="btn-secondary btn-small" onclick="lesOppProve()">üîä Les opp</button>
        </div>
    </div>

    <div id="oving-start" class="page">
        <div id="oving-valg" class="card-container">
            <h2>Velg Niv√•</h2>
            
            <div class="credit-progress-container">
                <div class="credit-label">
                    <span>Progresjon mot neste kort</span>
                    <span id="credit-progress-text-oving">0 poeng</span>
                </div>
                <div class="credit-track">
                    <div class="credit-fill" id="credit-progress-bar-oving"></div>
                </div>
            </div>

            <div class="trinn-grid" style="display:grid; gap:10px; margin: 20px 0;">
                <button class="trinn-btn" onclick="startOving('1-2')">1. - 2. Trinn</button>
                <button class="trinn-btn" onclick="startOving('3-4')">3. - 4. Trinn</button>
                <button class="trinn-btn" onclick="startOving('5-7')">5. - 7. Trinn</button>
            </div>

            <div class="lang-toggle" style="margin: 20px 0; display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <button class="lang-btn" id="lang-no" onclick="settSprakRetning('no')">
                    <span style="font-size:24px;">üá≥üá¥</span><br>Skriv Norsk
                </button>
                <button class="lang-btn" id="lang-en" onclick="settSprakRetning('en')">
                    <span style="font-size:24px;">üá¨üáß</span><br>Write English
                </button>
            </div>
        
       <div id="oving-omraade" class="card-container" style="display:none;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <span id="oving-score" style="font-weight:bold; color:var(--primary);">0 riktige</span>
                <button class="btn-small btn-danger" onclick="avsluttOving()">Avslutt</button>
            </div>
            
            <div class="credit-track" style="margin-top:10px; margin-bottom:20px;">
                <div class="credit-fill" id="credit-progress-bar-oving"></div>
            </div>
            <div style="text-align:right; font-size:12px; color:#888; margin-top:-15px; margin-bottom:20px;">
                <span id="credit-progress-text-oving">0</span> til neste poeng
            </div>
            
            <h1 id="oving-spm" style="text-align:center; font-size:40px; margin:10px 0 30px 0;">...</h1>
            
            <div style="text-align:center; margin-bottom:20px;">
                 <button class="btn-secondary btn-small" onclick="lesOppOving()">üîä Les opp</button>
            </div>

            <div id="oving-alternativer" style="display:none; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:20px;">
                </div>
            
            <div id="oving-input-container">
                <input type="text" id="oving-svar" placeholder="Skriv svaret..." autocomplete="off">
                <button class="btn-primary" onclick="sjekkOvingSvar()">Svar</button>
            </div>
            
            <p id="oving-feedback" style="text-align:center; font-weight:bold; min-height:24px; margin-top:10px;"></p>
        </div>

    <div id="elev-samling" class="page">
        <div class="samling-header">
            <h2>Min Samling</h2>
            <button class="btn-small" onclick="byttSortering()">Sortering ‚ÜïÔ∏è</button>
        </div>
        <div id="samling-liste" class="samling-grid"></div>
    </div>
    
    <div id="oving-samling" class="page">
        <div class="samling-header">
            <h2>Min Samling</h2>
            <button class="btn-small" onclick="byttSortering()">Sortering ‚ÜïÔ∏è</button>
        </div>
        <div class="samling-grid"></div> </div>

    <div id="laerer-dashboard" class="page">
        <div class="card-container">
            <h2>L√¶rerportal üçé</h2>
            <p>Lag en ny glosepr√∏ve.</p>
            
            <input type="text" id="prove-tittel" placeholder="Navn p√• pr√∏ve (f.eks Uke 42)">
            
            <div class="input-group" style="background:#f9f9f9; padding:15px; border-radius:10px; margin:15px 0;">
                <h4>Legg til ord:</h4>
                <input type="text" id="nytt-sporsmaal" placeholder="Norsk ord (Sp√∏rsm√•l)">
                <input type="text" id="nytt-svar" placeholder="Engelsk ord (Svar)">
                <button class="btn-secondary" onclick="leggTilOrd()">+ Legg til i listen</button>
            </div>
            
            <h4>Ord i pr√∏ven:</h4>
            <ul id="editor-liste" class="bibliotek-liste" style="min-height:50px; border:1px dashed #ccc; padding:10px;"></ul>
            
            <button class="btn-primary" onclick="lagreProve()">Lagre Pr√∏ve</button>
            <p style="font-size:12px; color:#999; margin-top:10px;">
                * Ved √• lagre godtar du at en anonym kopi sendes til Glosebanken.
            </p>
        </div>
    </div>

    <div id="gevinst-popup" class="popup-overlay" onclick="lukkKort()">
        <div class="popup-content gevinst-content">
            <h2>üéâ ET KORT!</h2>
            <div id="gevinst-navn" style="font-size:24px; font-weight:bold; margin:10px 0;"></div>
            <div id="gevinst-rarity"></div>
            <p style="margin-top:20px; color:#666;">Trykk for √• lukke</p>
        </div>
    </div>

    <div id="scanner-popup" class="popup-overlay">
        <div class="popup-content" style="background:black; padding:0;">
            <video id="qr-video" style="width:100%; height:300px; object-fit:cover;"></video>
            <div style="padding:15px;">
                <button class="btn-danger" onclick="lukkScanner()">Lukk Kamera</button>
            </div>
        </div>
    </div>
    
    <div id="info-modal" class="popup-overlay">
        <div class="popup-content">
            <h2>Om GloseMester</h2>
            <p>GloseMester er utviklet for √• motivere elever gjennom spillmekanikk.</p>
            <h3>Priser for Skoler</h3>
            <p>Kontakt oss for lisensavtale.</p>
            <button class="btn-secondary" onclick="this.parentElement.parentElement.style.display='none'">Lukk</button>
        </div>
    </div>

    <script src="js/vocabulary.js"></script>
    <script src="js/collection.js"></script>
    
    <script src="js/init.js"></script>

    <script type="module">
        import './js/app.js';

        // Importer alle funksjoner vi trenger i HTML
        import { velgRolle, tilbakeTilStart, visSide } from './js/core/navigation.js';
        import { startOving, sjekkOvingSvar, byttOvingRetning, lesOppOving, avsluttOving } from './js/features/practice.js';
        import { startProve, sjekkSvar, lesOppProve } from './js/features/quiz.js';
        import { leggTilOrd, slettOrd, lagreProve } from './js/features/teacher.js';
        import { startQRScanner, lukkScanner } from './js/features/qr-scanner.js';
        import { visSamling, byttSortering, lukkKort } from './js/features/kort-display.js';
        
        // Koble funksjonene til window (slik at onclick="..." virker)
        window.velgRolle = velgRolle;
        window.tilbakeTilStart = tilbakeTilStart;
        window.visSide = visSide;
        
        window.startOving = startOving;
        window.sjekkOvingSvar = sjekkOvingSvar;
        window.byttOvingRetning = byttOvingRetning;
        window.lesOppOving = lesOppOving;
        window.avsluttOving = avsluttOving;
        
        window.startProve = startProve;
        window.sjekkSvar = sjekkSvar;
        window.lesOppProve = lesOppProve;
        
        window.leggTilOrd = leggTilOrd;
        window.slettOrd = slettOrd;
        window.lagreProve = lagreProve;
        
        window.startQRScanner = startQRScanner;
        window.lukkScanner = lukkScanner;
        
        window.visSamling = visSamling;
        window.byttSortering = byttSortering;
        window.lukkKort = lukkKort;
        
        console.log("üîó Alt koblet opp fra index.html!");
    </script>
</body>
</html>