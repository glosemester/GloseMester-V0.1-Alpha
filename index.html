<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GloseMester</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icon.png">
    
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/glosebank-admin.css">
    <link rel="stylesheet" href="css/glosebank-browse.css">
    <link rel="stylesheet" href="css/standardprover.css">
    
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    
    <style>
        /* KRITISK FIX: Hindrer blank side ved innlasting */
        .page { display: none; }
        .page.active { display: block !important; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .version-tag {
            position: fixed; bottom: 10px; right: 15px; font-size: 11px;
            color: #0071e3; z-index: 50; font-weight: 600; font-family: monospace;
            cursor: pointer; transition: all 0.2s; background: rgba(255,255,255,0.9);
            padding: 5px 10px; border-radius: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        /* Footer styling spesifikt for landingssiden */
        .landing-footer {
            margin-top: 60px;
            padding: 30px 20px;
            background: #2c3e50;
            color: white;
            border-radius: 12px;
            text-align: center;
        }
    </style>
</head>
<body>

    <button id="lyd-toggle" class="icon-btn" 
            style="position:fixed; top:15px; right:15px; z-index:9999; font-size:1.5rem; background:rgba(255,255,255,0.8); border:none; border-radius:50%; width:50px; height:50px; cursor:pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2);" 
            aria-label="Skru av/pÃ¥ lyd">
        ğŸ”‡
    </button>

    <div id="landing-page" class="page active">
        <img src="header.png" alt="GloseMester" class="hero-image" style="width:100%; max-width:800px; height:auto; margin:0 auto 20px auto; display:block;">
        <p style="text-align:center; color:#666; max-width:500px; margin: 0 auto 40px auto; font-size:18px;">
            Samle kort, bygg din samling og lÃ¦r sprÃ¥k samtidig.
        </p>
        <div class="role-grid">
            <div class="role-card" onclick="velgRolle('oving')">
                <span class="role-icon">ğŸ’ª</span><h3>Ã˜v Selv</h3><p>Velg nivÃ¥ og samle kort</p>
            </div>
            <div class="role-card" onclick="velgRolle('kode')">
                <span class="role-icon">ğŸ“</span><h3>GlosePrÃ¸ve</h3><p>Har du prÃ¸vekode?</p>
            </div>
            <div class="role-card" onclick="velgRolle('laerer')">
                <span class="role-icon">ğŸ</span><h3>LÃ¦rer</h3><p>Lag prÃ¸ver</p>
            </div>
        </div>

        <button id="pwa-install-btn" class="btn-primary" style="display:none; margin: 30px auto; background-color: #2563EB; max-width: 300px;">
            ğŸ“² Installer App pÃ¥ mobilen
        </button>

        <div style="text-align:center; margin-top:40px; margin-bottom: 40px;">
            <button class="btn-primary" onclick="document.getElementById('info-modal').style.display='flex'">â„¹ï¸ For lÃ¦rere & foreldre</button>
        </div>

        <footer class="landing-footer">
            <p style="margin: 0 0 10px 0;">&copy; 2025 GloseMester | Laget med â¤ï¸ for norske lÃ¦rere</p>
            <p style="margin: 0; font-size: 13px;">
                <a href="/om-oss.html" style="color: white; margin: 0 10px; text-decoration: none;">Om oss</a> | 
                <a href="/oppgrader.html" style="color: white; margin: 0 10px; text-decoration: none;">Oppgrader</a> | 
                <a href="/personvern.html" style="color: white; margin: 0 10px; text-decoration: none;">Personvern</a> | 
                <a href="mailto:kontakt@glosemester.no" style="color: white; margin: 0 10px; text-decoration: none;">Kontakt</a>
            </p>
        </footer>
    </div>

    <nav id="elev-meny" style="display:none;">
        <button id="btn-elev-dashboard" onclick="visSide('elev-dashboard')">Hjem</button>
        <button id="btn-elev-samling" onclick="visSide('elev-samling'); visSamling()">Mine Kort</button>
        <button id="btn-galleri" onclick="visGalleriSide()">ğŸ† Galleri</button> 
        <button class="btn-danger" onclick="tilbakeTilStart()">Logg ut</button>
    </nav>

    <nav id="oving-meny" style="display:none;">
        <button id="btn-oving-start" onclick="visSide('oving-start')">Ã˜v</button>
        <button id="btn-oving-samling" onclick="visOvingSamling()">Samling</button>
        <button id="btn-oving-galleri" onclick="visGalleriSide()">ğŸ† Galleri</button>
        <button class="btn-danger" onclick="tilbakeTilStart()">Avslutt</button>
    </nav>

    <nav id="laerer-meny" class="laerer-nav" style="display:none;">
        <button id="hamburger-btn" class="hamburger-btn" aria-label="Meny">
            <span class="hamburger-icon">â˜°</span>
            <span class="hamburger-text">Meny</span>
        </button>
        
        <span id="user-info" class="user-info"></span>
        
        <div class="nav-actions">
            <button class="btn-primary nav-action-btn" onclick="tilbakeTilStart()">ğŸ  Hjem</button>
        </div>
    </nav>

    <div id="nav-items" class="nav-items">
        <button id="btn-laerer-dashboard" class="active" onclick="visSide('laerer-dashboard'); lukkHamburger()">ğŸ“Š Dashboard</button>
        <button id="btn-lagrede-prover" onclick="visSide('lagrede-prover'); lukkHamburger()">ğŸ“ Lagrede PrÃ¸ver</button>
        <button id="btn-standardprover" onclick="visSide('standardprover'); lukkHamburger()">ğŸ“š StandardprÃ¸ver</button>
        <button id="btn-glosebank-browse" onclick="visSide('glosebank-browse'); lukkHamburger()" style="display:none;">ğŸ“š GloseBank</button>
        <button id="btn-admin-panel" onclick="visSide('admin-panel'); lukkHamburger()" style="display:none;">ğŸ”§ Admin</button>
        <button onclick="loggUt()" style="border-top: 2px solid #eee; margin-top: auto; color: #dc2626;">ğŸšª Logg ut</button>
    </div>

    <div id="hamburger-overlay" class="hamburger-overlay" onclick="lukkHamburger()"></div>

    <div id="elev-dashboard" class="page">
        <div class="card-container" id="elev-start-skjerm">
            <div style="margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid #eee;">
                <div style="display:flex; justify-content:space-between; font-size:12px; color:#666; margin-bottom:5px;">
                    <span>Mot neste kort:</span>
                    <span id="quiz-progress-text">0 / 10</span>
                </div>
                <div id="elev-start-progress-target" style="min-height: 25px;"></div>
            </div>

            <h2>Klar for prÃ¸ve?</h2>
            <p style="margin-bottom:15px; color:#666;">Skriv inn koden du fikk av lÃ¦reren, eller skann QR.</p>
            
            <input type="text" id="prove-kode" placeholder="F.eks: ABC-123">
            <div style="display:flex; gap:10px; justify-content:center; margin-top:10px;">
                <button class="btn-primary" onclick="startProve()">Start PrÃ¸ve</button>
                <button class="btn-primary" onclick="startQRScanner()">ğŸ“· Skann QR</button>
            </div>

            <div id="elev-lagrede-prover-container" style="display:none; margin-top:30px;">
                <h4 style="margin-bottom:10px; color:#333;">Dine prÃ¸ver (Lagret i 7 dager)</h4>
                <div id="elev-lagrede-liste" style="display:grid; gap:10px;"></div>
            </div>
        </div>
        
        <div id="prove-omraade" class="card-container" style="display:none;">
            <div style="display:flex; justify-content:space-between;">
                <h3>PrÃ¸ve</h3>
                <span id="quiz-progress">1/10</span>
            </div>
            
            <div id="quiz-progress-target" style="margin: 20px 0;"></div>
            
            <h1 id="quiz-spm" style="text-align:center; margin: 30px 0; font-size:32px;">...</h1>
            <input type="text" id="quiz-input" placeholder="Svar her...">
            <button class="btn-primary" onclick="sjekkSvar()">Svar</button>
            <button class="btn-primary btn-small" onclick="lesOppProve()">ğŸ”Š Les opp</button>
        </div>
    </div>

    <div id="oving-start" class="page">
        <div id="oving-valg" class="card-container">
            <h2>Velg NivÃ¥</h2>
            <div class="credit-progress-container">
                <div class="credit-label">
                    <span>Mot neste bonuspoeng (100 xp)</span>
                    <span id="menu-credits-text">0 / 100</span>
                </div>
                <div class="yellow-track">
                    <div class="yellow-fill" id="menu-credits-bar"></div>
                </div>
            </div>
            <div class="trinn-grid">
               <button class="trinn-btn" onclick="startOving('niva1')">â­ NivÃ¥ 1 (Begynner)</button>
               <button class="trinn-btn" onclick="startOving('niva2')">â­â­ NivÃ¥ 2 (Middels)</button>
               <button class="trinn-btn" onclick="startOving('niva3')">â­â­â­ NivÃ¥ 3 (Ekspert)</button>
            </div>
        </div>
    </div>

    <div id="oving-omraade" class="page">
        <div class="card-container">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <span id="oving-score" style="font-weight:bold; color:var(--accent-blue);">0 riktige i dag</span>
                <button class="btn-small btn-danger" onclick="avsluttOving()">Avslutt</button>
            </div>
            
            <div id="game-progress-target" style="margin-bottom: 20px;"></div>

            <div style="text-align:center; font-size:13px; color:#888; margin-bottom:30px;">
                <span id="game-progress-text">Start jakten pÃ¥ nytt kort!</span>
            </div>
            
            <h1 id="oving-spm" style="text-align:center; font-size:40px; margin:10px 0 30px 0;">...</h1>
            
            <div style="text-align:center; margin-bottom:20px;">
                 <button class="btn-primary btn-small" onclick="lesOppOving()">ğŸ”Š Les opp</button>
            </div>
            
            <div id="oving-alternativer" style="display:none; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:20px;"></div>
            
            <div id="oving-input-container">
                <input type="text" id="oving-svar" placeholder="Skriv svaret..." autocomplete="off">
                <button class="btn-primary" onclick="sjekkOvingSvar()">Svar</button>
            </div>
            
            <p id="oving-feedback" style="text-align:center; font-weight:bold; min-height:24px; margin-top:10px;"></p>
        </div>
    </div>
    
    <div id="oving-samling" class="page">
        <div class="bank-container">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                <span style="font-size:24px; font-weight:bold;">ğŸ’ <span class="antall-diamanter">0</span></span>
                <span style="font-size:12px; color:#666;">Neste bonus om:</span>
            </div>
            <div class="yellow-track"><div class="yellow-fill samling-bonus-bar"></div></div>
            <div style="text-align:right; font-size:11px; color:#999; margin-top:2px;"><span class="bonus-tekst">0 / 100 XP</span></div>
            
            <div style="background:#e3f2fd; border: 1px solid #bbdefb; border-radius:8px; padding:10px; margin-top:15px; font-size:13px; display:flex; gap:10px; align-items:center;">
                <span style="font-size:24px;">â™»ï¸</span>
                <span>
                    <strong>PANT DUBLETTER!</strong><br>
                    Har du to like kort? Trykk pÃ¥ dem for Ã¥ bytte dem inn.<br>
                    Du fÃ¥r et helt nytt kort i retur! (Pris: 1 ğŸ’)
                </span>
            </div>
        </div>
        <div class="samling-header" style="margin-top:20px;">
            <h2>Min Samling</h2>
            <button class="btn-small" onclick="byttSortering()">Sortering â†•ï¸</button>
        </div>
        <div class="samling-grid"></div>
    </div>

    <div id="elev-samling" class="page">
        <div class="bank-container">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                <span style="font-size:24px; font-weight:bold;">ğŸ’ <span class="antall-diamanter">0</span></span>
                <span style="font-size:12px; color:#666;">Neste bonus om:</span>
            </div>
            <div class="yellow-track"><div class="yellow-fill samling-bonus-bar"></div></div>
            <div style="text-align:right; font-size:11px; color:#999; margin-top:2px;"><span class="bonus-tekst">0 / 100 XP</span></div>
            
            <div style="background:#e3f2fd; border: 1px solid #bbdefb; border-radius:8px; padding:10px; margin-top:15px; font-size:13px; display:flex; gap:10px; align-items:center;">
                <span style="font-size:24px;">â™»ï¸</span>
                <span>
                    <strong>PANT DUBLETTER!</strong><br>
                    Har du to like kort? Trykk pÃ¥ dem for Ã¥ bytte dem inn.<br>
                    Du fÃ¥r et helt nytt kort i retur! (Pris: 1 ğŸ’)
                </span>
            </div>
        </div>
        <div class="samling-header" style="margin-top:20px;">
            <h2>Min Samling</h2>
            <button class="btn-small" onclick="byttSortering()">Sortering â†•ï¸</button>
        </div>
        <div class="samling-grid"></div>
    </div>

    <div id="galleri-visning" class="page">
        <div class="card-container">
            <h2>ğŸ† Master Galleri</h2>
            <p style="color:#666; margin-bottom:20px;">Se alle kort du kan samle</p>
            <div id="galleri-container" class="samling-grid"></div>
        </div>
    </div>

    <div id="laerer-dashboard" class="page">
        <div class="card-container">
            <h2>Velkommen, LÃ¦rer!</h2>
            <p style="color:#666; margin-bottom:20px;">Lag prÃ¸ver, del med QR-kode og fÃ¸lg med pÃ¥ elevenes resultater.</p>

            <!-- âœ… NY: Analytics Dashboard -->
            <div id="dashboard-stats" style="margin-bottom: 30px;">
                <!-- Dashboard-data lastes her av teacher-analytics.js -->
            </div>

            <!-- Eksporter-knapp -->
            <div style="text-align: right; margin-bottom: 20px;">
                <button class="btn-secondary btn-small" onclick="eksporterTilCSV(window.lastLoadedDashboardData)" style="padding: 8px 16px;">
                    ğŸ“¥ Eksporter statistikk (CSV)
                </button>
            </div>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-bottom:30px;">
                <div class="bank-container" style="text-align:center; cursor:pointer;" onclick="visSide('lag-prove')">
                    <div style="font-size:48px; margin-bottom:10px;">ğŸ“</div>
                    <h3 style="margin:0; font-size:18px;">Lag PrÃ¸ve</h3>
                    <p style="margin:5px 0 0 0; font-size:13px; color:#666;">Opprett ny ordlistetest</p>
                </div>
                <div class="bank-container" style="text-align:center; cursor:pointer;" onclick="visSide('lagrede-prover')">
                    <div style="font-size:48px; margin-bottom:10px;">ğŸ’¾</div>
                    <h3 style="margin:0; font-size:18px;">Mine PrÃ¸ver</h3>
                    <p style="margin:5px 0 0 0; font-size:13px; color:#666;">Se og administrer</p>
                </div>
            </div>

            <div id="abonnement-info" style="background:#F0F9FF; padding:20px; border-radius:12px; border:2px solid #BAE6FD; margin-bottom:20px;"></div>

            <div style="background:#F9FAFB; padding:20px; border-radius:12px; border:1px solid #E5E7EB;">
                <h3 style="margin:0 0 15px 0; font-size:16px; color:#374151;">ğŸ Har du kampanjekode?</h3>
                <div style="display:flex; gap:10px;">
                    <input type="text" id="kampanje-input" placeholder="F.eks: BETA2026" style="flex:1; margin:0;">
                    <button class="btn-primary" onclick="aktiverKampanjekode()" style="width:auto; padding:12px 25px; margin:0;">
                        Aktiver
                    </button>
                </div>
                <p style="margin:10px 0 0 0; font-size:12px; color:#6B7280;">
                    Premium-koder gir tilgang til ubegrenset antall prÃ¸ver, standardprÃ¸ver og statistikk.
                </p>
            </div>
        </div>
    </div>

    <div id="lag-prove" class="page">
        <div class="card-container">
            <h2>Lag Ny PrÃ¸ve</h2>
            <input type="text" id="prove-tittel" placeholder="Tittel pÃ¥ prÃ¸ven (f.eks. Familie)">
            
            <div style="background:#F0F9FF; padding:15px; border-radius:12px; margin:15px 0;">
                <h3 style="margin:0 0 10px 0; font-size:15px;">â• Legg til ord</h3>
                <div style="display:flex; gap:10px; margin-bottom:10px;">
                    <input type="text" id="norsk-ord" placeholder="Norsk ord" style="flex:1; margin:0;">
                    <input type="text" id="engelsk-ord" placeholder="English word" style="flex:1; margin:0;">
                    <button class="btn-primary" onclick="leggTilOrd()" style="width:auto; padding:12px 20px; margin:0;">â•</button>
                </div>
            </div>

            <div id="ordliste-preview" style="margin:20px 0;"></div>

            <button class="btn-primary" onclick="lagreProve()">ğŸ’¾ Lagre PrÃ¸ve</button>
        </div>
    </div>

    <div id="lagrede-prover" class="page">
        <div class="card-container">
            <h2>Mine Lagrede PrÃ¸ver</h2>
            <p style="color:#666; margin-bottom:20px;">Alle dine opprettede prÃ¸ver. Del med QR-kode eller prÃ¸vekode.</p>
            <div id="prover-liste"></div>
        </div>
    </div>

    <div id="standardprover" class="page">
        <div class="card-container">
            <h2>ğŸ“š StandardprÃ¸ver</h2>
            <p style="color:#666; margin-bottom:20px;">
                Ferdiglagde prÃ¸ver alignert med LK20. Kun tilgjengelig for Premium og Skolepakke.
            </p>
            
            <div class="standardprover-filter" style="margin-bottom:20px;">
                <label style="display:block; font-weight:600; margin-bottom:8px;">Filtrer etter nivÃ¥:</label>
                <div style="display:flex; gap:10px; flex-wrap:wrap;">
                    <button id="filter-alle" class="filter-btn active" onclick="filtrerStandardprover('alle')">Alle</button>
                    <button id="filter-barneskole" class="filter-btn" onclick="filtrerStandardprover('Barneskole')">Barneskole (1-7)</button>
                    <button id="filter-ungdomsskole" class="filter-btn" onclick="filtrerStandardprover('Ungdomsskole')">Ungdomsskole (8-10)</button>
                    <button id="filter-vgs" class="filter-btn" onclick="filtrerStandardprover('VideregÃ¥ende')">VideregÃ¥ende</button>
                </div>
            </div>
            
            <div id="standardprover-liste"></div>
        </div>
    </div>

    <div id="glosebank-browse" class="page">
        <div class="card-container">
            <h2>ğŸ“š GloseBank</h2>
            <p style="color:#666; margin-bottom:20px;">SÃ¸k og last ned prÃ¸ver fra andre lÃ¦rere. Kun tilgjengelig for Skolepakke.</p>
            
            <div class="glosebank-filter" style="margin-bottom:20px;">
                <input type="text" id="glosebank-sok" placeholder="ğŸ” SÃ¸k etter prÃ¸ver..." style="margin-bottom:10px;">
                
                <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:10px;">
                    <select id="filter-fag">
                        <option value="">Alle fag</option>
                        <option value="Engelsk">Engelsk</option>
                        <option value="Norsk">Norsk</option>
                        <option value="Matematikk">Matematikk</option>
                    </select>
                    <select id="filter-nivaa">
                        <option value="">Alle nivÃ¥</option>
                        <option value="Barneskole">Barneskole</option>
                        <option value="Ungdomsskole">Ungdomsskole</option>
                        <option value="VideregÃ¥ende">VideregÃ¥ende</option>
                    </select>
                    <select id="filter-sortering">
                        <option value="nyeste">Nyeste fÃ¸rst</option>
                        <option value="rating">HÃ¸yest rating</option>
                        <option value="populaer">Most populÃ¦r</option>
                    </select>
                </div>
            </div>
            <div id="glosebank-liste"></div>
        </div>
    </div>

    <div id="admin-panel" class="page">
        <div class="card-container">
            <h2>ğŸ”§ Admin-panel</h2>
            <p style="color:#666; margin-bottom:20px;">Administrer GloseBank-prÃ¸ver, brukere og systeminnstillinger.</p>
            
            <div class="admin-tabs" style="display: flex; gap: 0; border-bottom: 2px solid #e0e0e0; margin-bottom: 30px; flex-wrap: wrap;">
                <button id="tab-glosebank" class="admin-tab active" onclick="visFane('glosebank')" style="padding: 15px 25px; background: white; border: none; border-bottom: 3px solid #0071e3; font-weight: 600; font-size: 15px; cursor: pointer; transition: all 0.3s;">ğŸ“Š GloseBank</button>
                <button id="tab-brukere" class="admin-tab" onclick="visFane('brukere')" style="padding: 15px 25px; background: white; border: none; border-bottom: 3px solid transparent; font-weight: 600; font-size: 15px; cursor: pointer; transition: all 0.3s; color: #666;">ğŸ‘¥ Brukere</button>
                <button id="tab-verktoy" class="admin-tab" onclick="visFane('verktoy')" style="padding: 15px 25px; background: white; border: none; border-bottom: 3px solid transparent; font-weight: 600; font-size: 15px; cursor: pointer; transition: all 0.3s; color: #666;">ğŸ› ï¸ VerktÃ¸y</button>
            </div>
            
            <div id="fane-glosebank" class="admin-fane" style="display: block;">
                <h3>ğŸ“Š GloseBank-prÃ¸ver</h3>
                <p style="color:#666; margin-bottom:20px;">Godkjenn, rediger eller slett prÃ¸ver fra GloseBank.</p>
                <div class="filter-buttons" style="margin-bottom:20px; display:flex; gap:10px; flex-wrap: wrap;">
                    <button id="filter-all" class="filter-btn" onclick="endreFilter('all')">Alle (<span id="filter-count-all">0</span>)</button>
                    <button id="filter-pending" class="filter-btn active" onclick="endreFilter('pending')">â³ Pending (<span id="filter-count-pending">0</span>)</button>
                    <button id="filter-approved" class="filter-btn" onclick="endreFilter('approved')">âœ… Godkjent (<span id="filter-count-approved">0</span>)</button>
                </div>
                <div id="glosebank-admin-liste"></div>
            </div>
            
            <div id="fane-brukere" class="admin-fane" style="display: none;">
                <h3>ğŸ‘¥ Brukeradministrasjon</h3>
                <p style="color:#666; margin-bottom:20px;">Administrer brukere, abonnementer og tilganger.</p>
                <div id="brukeradmin-stats"></div>
                <div id="brukeradmin-liste"></div>
            </div>
            
            <div id="fane-verktoy" class="admin-fane" style="display: none;">
                <h3>ğŸ› ï¸ Admin-verktÃ¸y</h3>
                <p style="color:#666; margin-bottom:20px;">Systeminnstillinger og administrative verktÃ¸y.</p>
                <div id="admin-verktoy-container"></div>
            </div>
        </div>
    </div>

    <div id="laerer-login-popup" class="popup-overlay" style="display:none;">
        <div class="popup-content" style="max-width: 450px;">
            <h2>LÃ¦rer Innlogging ğŸ</h2>
            
            <div class="feide-login-wrapper" style="margin-bottom: 20px;">
                <button class="btn-primary" onclick="loggInnMedFeide()" style="background:#00509E; width:100%; display:flex; align-items:center; justify-content:center; gap:10px; margin-bottom: 5px;">
                    Logg inn med Feide (Skolelisens)
                </button>
                <p class="login-info-text" style="color: #666; font-size: 13px; text-align: center; line-height: 1.4; margin-top: 5px; margin-bottom: 0;">
                    <small>
                        <em>* Krever at din skole har avtale.<br>
                        Mangler dere lisens? <a href="mailto:kontakt@glosemester.no" style="color: #00509E; text-decoration: underline;">Kontakt oss</a>.</em>
                    </small>
                </p>
            </div>
            <button class="btn-primary" onclick="loggInnMedGoogle()" style="background:#4285f4; width:100%; display:flex; align-items:center; justify-content:center; gap:10px;">Logg inn med Google</button>
            
            <div style="display:flex; align-items:center; margin:20px 0;">
                <div style="flex:1; height:1px; background:#e0e0e0;"></div>
                <span style="padding:0 15px; color:#999; font-size:13px;">eller</span>
                <div style="flex:1; height:1px; background:#e0e0e0;"></div>
            </div>
            
            <input type="email" id="laerer-email" placeholder="E-post" style="margin-bottom:10px; width:100%;">
            <input type="password" id="laerer-passord" placeholder="Passord" style="margin-bottom:15px; width:100%;">
            
            <button class="btn-primary" onclick="loggInnMedEmail()" style="width:100%;">ğŸ“§ Logg inn med E-post</button>
            
            <p style="text-align:center; margin-top:20px; font-size:13px; color:#666;">Ingen konto? <a href="#" onclick="event.preventDefault(); visRegistrering();" style="color:var(--accent-blue);">Registrer deg her</a></p>
            
            <button class="btn-small btn-danger" onclick="document.getElementById('laerer-login-popup').style.display='none'; tilbakeTilStart();" style="margin-top:15px; width:100%;">Avbryt</button>
        </div>
    </div>

    <div id="laerer-register-popup" class="popup-overlay" style="display:none;">
        <div class="popup-content" style="max-width: 400px;">
            <h2>Opprett LÃ¦rerkonto ğŸ</h2>
            <input type="text" id="reg-navn" placeholder="Fullt navn" style="margin-bottom:10px;">
            <input type="email" id="reg-email" placeholder="E-post" style="margin-bottom:10px;">
            <input type="password" id="reg-passord" placeholder="Passord (min 6 tegn)" style="margin-bottom:10px;">
            <input type="password" id="reg-passord-bekreft" placeholder="Bekreft passord" style="margin-bottom:15px;">
            <button class="btn-primary" onclick="registrerLaerer()" style="width:100%;">Opprett konto</button>
            <p style="text-align:center; margin-top:15px; font-size:13px; color:#666;">Har allerede konto? <a href="#" onclick="event.preventDefault(); visInnlogging();" style="color:var(--accent-blue);">Logg inn her</a></p>
            
            <button class="btn-small btn-danger" onclick="document.getElementById('laerer-register-popup').style.display='none'; tilbakeTilStart();" style="margin-top:15px; width:100%;">Avbryt</button>
        </div>
    </div>

    <div id="personvern-popup" class="popup-overlay" style="display:none;">
        <div class="popup-content" style="max-width: 600px; max-height: 80vh; overflow-y: auto;">
            <h2>ğŸ›¡ï¸ Velkommen!</h2>
            <p>Vi lagrer kun nÃ¸dvendig informasjon. Se <a href="personvern.html" target="_blank">personvern.html</a> for detaljer.</p>
            <div style="display:flex; gap:10px; margin-top:25px;">
                <button class="btn-primary" onclick="godtaPersonvern()" style="flex:1;">âœ… Jeg godtar</button>
                <button class="btn-primary" onclick="avvisPersonvern()" style="flex:1;">âŒ Avvis</button>
            </div>
        </div>
    </div>

    <div id="gevinst-popup" class="popup-overlay" style="display:none;" onclick="lukkKort()">
        <div class="popup-content gevinst-content">
            <h2>ğŸ‰ ET KORT!</h2>
            <div id="gevinst-navn" style="font-size:24px; font-weight:bold; margin:10px 0;"></div>
            <div id="gevinst-rarity"></div>
            <p style="margin-top:20px; color:#666;">Trykk for Ã¥ lukke</p>
        </div>
    </div>
    
    <div id="feil-svar-popup" class="popup-overlay" style="display:none; z-index: 15000;">
        <div class="popup-content" style="text-align:center; border-top: 5px solid #ff3b30;">
            <div style="font-size: 50px; margin-bottom: 10px;">ğŸ˜£</div>
            <h2 style="color: #ff3b30; margin: 0 0 10px 0;">Beklager!</h2>
            <p style="color:#666; font-size: 14px; margin-bottom:5px;">Riktig svar var:</p>
            <h3 id="fasit-tekst" style="font-size: 24px; color: #333; background: #f5f5f5; padding: 15px; border-radius: 10px; border: 1px dashed #ccc;">...</h3>
            <button class="btn-primary" onclick="lukkFeilPopup()" style="width:100%; margin-top:20px; background-color: #333;">Neste ord â¡ï¸</button>
        </div>
    </div>

    <div id="scanner-popup" class="popup-overlay" style="display:none;">
        <div class="popup-content" style="background:black; padding:0;">
            <video id="qr-video" style="width:100%; height:300px; object-fit:cover;"></video>
            <div style="padding:15px;"><button class="btn-danger" onclick="lukkScanner()">Lukk Kamera</button></div>
        </div>
    </div>

    <div id="ios-install-popup" class="popup-overlay" style="display:none; z-index: 12000;">
        <div class="popup-content" style="max-width:350px; text-align:left;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h3 style="margin:0;">ğŸ“² Installer pÃ¥ iPhone</h3>
                <button onclick="document.getElementById('ios-install-popup').style.display='none'" style="background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
            </div>
            <p style="font-size:14px; line-height:1.5; margin-bottom:20px;">Apple tillater ikke automatisk installasjon. GjÃ¸r dette:</p>
            <div style="background:#f5f5f7; padding:15px; border-radius:12px; font-size:14px;">
                <div style="margin-bottom:12px; display:flex; align-items:center; gap:10px;"><span style="font-size:20px;">1ï¸âƒ£</span> <span>Trykk pÃ¥ <strong>Del-knappen</strong> <br><span style="font-size:12px; color:#666;">(Ligger nederst eller Ã¸verst i nettleseren)</span></span></div>
                <div style="margin-bottom:12px; display:flex; align-items:center; gap:10px;"><span style="font-size:20px;">2ï¸âƒ£</span> <span>Scroll ned og velg <br><strong>"Legg til pÃ¥ Hjem-skjerm"</strong> â•</span></div>
                <div style="display:flex; align-items:center; gap:10px;"><span style="font-size:20px;">3ï¸âƒ£</span> <span>Trykk <strong>"Legg til"</strong> oppe til hÃ¸yre.</span></div>
            </div>
            <button class="btn-primary" onclick="document.getElementById('ios-install-popup').style.display='none'" style="margin-top:20px;">Jeg forstÃ¥r ğŸ‘</button>
        </div>
    </div>

    <div id="upgrade-modal" class="popup-overlay" style="display:none;" onclick="if(event.target === this) this.style.display='none'">
        <div class="popup-content" style="max-width:600px; max-height:90vh; overflow-y:auto;" onclick="event.stopPropagation()">
            <h2 style="margin-top:0;">â­ Oppgrader til Premium</h2>
            <p style="color:#666; margin-bottom:30px;">FÃ¥ ubegrenset antall prÃ¸ver, statistikk og tilgang til standardprÃ¸ver.</p>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-bottom:30px;">
                <div style="background:#F9FAFB; padding:20px; border-radius:12px; border:2px solid #E5E7EB;">
                    <div style="font-size:14px; color:#6B7280; font-weight:600; margin-bottom:10px;">GRATIS</div>
                    <div style="font-size:32px; font-weight:700; margin-bottom:5px;">0 kr</div>
                    <div style="color:#666; font-size:13px; margin-bottom:20px;">For utprÃ¸ving</div>
                    <ul style="list-style:none; padding:0; margin:0 0 20px 0; font-size:13px;">
                        <li style="padding:8px 0; border-bottom:1px solid #E5E7EB;">âœ… 3 prÃ¸ver</li>
                        <li style="padding:8px 0; border-bottom:1px solid #E5E7EB;">âœ… QR-deling</li>
                        <li style="padding:8px 0; border-bottom:1px solid #E5E7EB;">âŒ Statistikk</li>
                        <li style="padding:8px 0; border-bottom:1px solid #E5E7EB;">âŒ Rediger & Dupliser</li>
                        <li style="padding:8px 0;">âŒ StandardprÃ¸ver</li>
                    </ul>
                    <button class="btn-primary" disabled style="width:100%; opacity:0.5;">NÃ¥vÃ¦rende plan</button>
                </div>
                <div style="background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding:20px; border-radius:12px; border:3px solid #5B21B6; color:white; position:relative;">
                    <div style="position:absolute; top:-12px; right:20px; background:#10B981; color:white; padding:4px 12px; border-radius:20px; font-size:11px; font-weight:700;">ANBEFALT</div>
                    <div style="font-size:14px; font-weight:600; margin-bottom:10px; opacity:0.9;">PREMIUM LÃ†RER</div>
                    <div style="font-size:32px; font-weight:700; margin-bottom:5px;">99 kr/mnd</div>
                    <div style="font-size:13px; margin-bottom:10px; opacity:0.9;">eller</div>
                    <div style="font-size:24px; font-weight:700; margin-bottom:5px;">800 kr/Ã¥r</div>
                    <div style="font-size:13px; margin-bottom:20px; opacity:0.9;">(spar 388 kr)</div>
                    <ul style="list-style:none; padding:0; margin:0 0 20px 0; font-size:13px;">
                        <li style="padding:8px 0; border-bottom:1px solid rgba(255,255,255,0.2);">âœ… Ubegrenset prÃ¸ver</li>
                        <li style="padding:8px 0; border-bottom:1px solid rgba(255,255,255,0.2);">âœ… Statistikk & analyse</li>
                        <li style="padding:8px 0; border-bottom:1px solid rgba(255,255,255,0.2);">âœ… Rediger & Dupliser</li>
                        <li style="padding:8px 0; border-bottom:1px solid rgba(255,255,255,0.2);">âœ… 16 StandardprÃ¸ver</li>
                        <li style="padding:8px 0;">âœ… Excel-eksport</li>
                    </ul>
                    <button onclick="startPremiumBetaling()" class="btn-primary" style="width:100%; background:white; color:#5B21B6; font-weight:700;">â­ Oppgrader nÃ¥</button>
                </div>
            </div>
            
            <div style="background:#FFF7ED; padding:20px; border-radius:12px; border:2px solid #FDBA74; margin-bottom:20px;">
                <h3 style="margin:0 0 10px 0; font-size:18px; color:#C2410C;">ğŸ« Skolepakker</h3>
                <p style="color:#9A3412; font-size:14px; margin-bottom:15px;">Spesialtilbud for skoler og kommuner</p>
                <button onclick="kontaktForSkolepakke()" class="btn-primary" style="width:100%; margin-top:20px; background:#C2410C; border:none;">ğŸ“§ Kontakt oss for tilbud</button>
            </div>
            
            <div style="background:#F0FDF4; padding:20px; border-radius:12px; border:2px solid #86EFAC; margin-bottom:20px;">
                <h3 style="margin:0 0 10px 0; font-size:16px; color:#166534;">ğŸ Har du kampanjekode?</h3>
                <p style="color:#15803D; font-size:13px; margin-bottom:15px;">Aktiver kampanjekode for gratis premium-tilgang</p>
                <div style="display:flex; gap:10px;">
                    <input type="text" id="kampanje-input-modal" placeholder="F.eks: BETA2026" style="flex:1; margin:0;">
                    <button class="btn-primary" onclick="aktiverKampanjekode()" style="width:auto; padding:12px 25px; margin:0; background:#16A34A; border:none;">Aktiver</button>
                </div>
                <p style="margin:15px 0 0 0; font-size:12px; color:#15803D;">
                    <strong>Tilgjengelige kampanjekoder:</strong><br>
                    â€¢ <code>BETA2026</code> - 90 dager Premium<br>
                    â€¢ <code>LANSERING</code> - 30 dager Premium<br>
                    â€¢ <code>TEST30</code> - 30 dager Premium<br>
                    â€¢ <code>SKOLE2026</code> - 365 dager Skolepakke
                </p>
            </div>
            <button class="btn-danger" onclick="document.getElementById('upgrade-modal').style.display='none'" style="width:100%; margin-top:20px;">Kanskje senere</button>
        </div>
    </div>

    <script>
        function startPremiumBetaling() {
            alert("Betaling kommer snart!\n\nVi jobber med Ã¥ integrere Vipps og Stripe.\n\nTil da kan du bruke kampanjekode 'BETA2026' for 3 mÃ¥neders gratis tilgang.");
            const input = document.getElementById('kampanje-input');
            if (input) input.value = 'BETA2026';
        }
        function kontaktForSkolepakke() {
            const user = auth?.currentUser;
            const epost = user ? user.email : 'din@skole.no';
            const subject = encodeURIComponent('ForespÃ¸rsel om skolepakke - GloseMester');
            const body = encodeURIComponent(`Hei!\n\nJeg er interessert i en skolepakke for GloseMester.\n\nSkole/Organisasjon: [Skriv inn]\nAntall lÃ¦rere: [Skriv inn]\nKontaktperson: [Skriv inn]\nTelefon: [Skriv inn]\n\nMin e-post: ${epost}\n\nMvh`);
            window.location.href = `mailto:kontakt@glosemester.no?subject=${subject}&body=${body}`;
        }
    </script>
    
    <div id="info-modal" class="popup-overlay" style="display:none;">
    <div class="popup-content" style="max-width:500px;">
        
        <div class="modal-header-fancy">
            <h2>GloseMester ğŸ’</h2>
            <p>GjÃ¸r glosepugging om til en skattejakt!</p>
        </div>

        <div class="modal-body">
            
            <div class="feature-section">
                <div class="feature-title">ğŸ« FOR SKOLER & LÃ†RERE</div>
                <ul class="feature-list">
                    <li><span class="feature-icon">âœ…</span> <span><strong>Trygt & Enkelt:</strong> GDPR-vennlig og ingen elev-login nÃ¸dvendig.</span></li>
                    <li><span class="feature-icon">â±ï¸</span> <span><strong>Spar Tid:</strong> "Ã˜v Selv" gir mengdetrening uten at du mÃ¥ rette.</span></li>
                    <li><span class="feature-icon">ğŸ”¥</span> <span><strong>Motivasjon:</strong> Elevene jakter pÃ¥ legendariske kort mens de lÃ¦rer.</span></li>
                </ul>
            </div>

            <div class="feature-section">
                <div class="feature-title">ğŸ§’ FOR ELEVER</div>
                <ul class="feature-list">
                    <li><span class="feature-icon">ğŸ¦–</span> <span>Samle <strong>150+ unike kort</strong> (biler, dyr, guder).</span></li>
                    <li><span class="feature-icon">â™»ï¸</span> <span><strong>Panteordning:</strong> Bytt dubletter mot diamanter.</span></li>
                    <li><span class="feature-icon">ğŸ‰</span> <span>LÃ¦r engelsk, vinn premier i spillet.</span></li>
                </ul>
            </div>

            <div class="contact-box">
                <p style="font-size:13px; font-weight:bold; margin:0 0 10px 0; color:#333;">Fant du en feil eller har et tips?</p>
                <div class="contact-links">
                    <a href="mailto:system@glosemester.no?subject=Feilmelding" class="contact-btn">
                        ğŸ Meld feil
                    </a>
                    <a href="mailto:kontakt@glosemester.no?subject=Hei" class="contact-btn">
                        âœ‰ï¸ Kontakt oss
                    </a>
                </div>
            </div>

            <button class="btn-close-fancy" onclick="document.getElementById('info-modal').style.display='none'">
                Lukk vindu
            </button>
        </div>

    </div>
</div>
    
    <div id="changelog-popup" class="popup-overlay" style="display:none;" onclick="this.style.display='none'">
        <div class="popup-content" style="max-width: 500px;" onclick="event.stopPropagation()">
            <h2>ğŸ“‹ v0.9.8-BETA</h2>
            <p><strong>ğŸ‰ Feilrettinger & Forbedringer</strong><br>
            âœ… Fikset problem med blank side<br>
            âœ… Oppdatert navigasjon<br>
            âœ… Lagt til Om Oss & Footer (kun pÃ¥ forside)<br>
            </p>
            <button class="btn-primary" onclick="document.getElementById('changelog-popup').style.display='none'" style="width:100%; margin-top:20px;">Lukk</button>
        </div>
    </div>

    <div class="version-tag" onclick="document.getElementById('changelog-popup').style.display='flex'">v0.9.8-BETA</div>

    <script type="module" src="js/init.js"></script>
    <script type="module">
        import './js/init.js';
        import './js/app.js';
        
        // Ekstra sikkerhet: Sjekk at app.js lastes
        window.addEventListener('load', function() {
            if (typeof velgRolle !== 'function') {
                console.warn('âš ï¸ App.js funksjoner mangler, laster fallback...');
                import('./js/app.js').then(module => {
                    console.log('âœ… App.js lastet manuelt');
                }).catch(err => console.error('âŒ Kunne ikke laste App.js:', err));
            }
        });
    </script>

    <div id="skolepakke-modal" class="popup-overlay" style="display:none;">
        <div class="popup-content" style="max-width:600px;">
            <button class="popup-close" onclick="lukkPopup('skolepakke-modal')" style="position:absolute; top:15px; right:15px; background:none; border:none; font-size:24px; cursor:pointer;">Ã—</button>
            
            <h2 style="text-align:center; margin-bottom:10px;">ğŸ« Skolepakke</h2>
            <p style="text-align:center; color:#666; margin-bottom:30px;">
                GloseMester for hele skolen - fra 5000 kr/Ã¥r
            </p>
            
            <form id="skolepakke-form" onsubmit="event.preventDefault(); sendSchoolInquiry();" style="margin-top:25px;">
                <h3 style="margin-bottom:15px;">Send forespÃ¸rsel:</h3>
                
                <label style="display:block; margin-bottom:15px;">
                    <span style="display:block; margin-bottom:5px; font-weight:500;">Skolens navn *</span>
                    <input type="text" id="school-name" required placeholder="Eks: Levanger Ungdomsskole" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:6px;">
                </label>
                
                <label style="display:block; margin-bottom:15px;">
                    <span style="display:block; margin-bottom:5px; font-weight:500;">Organisasjonsnummer *</span>
                    <input type="text" id="org-number" required placeholder="9 siffer" pattern="[0-9]{9}" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:6px;">
                </label>
                
                <label style="display:block; margin-bottom:15px;">
                    <span style="display:block; margin-bottom:5px; font-weight:500;">Kontaktperson *</span>
                    <input type="text" id="contact-person" required placeholder="Fullt navn" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:6px;">
                </label>
                
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-bottom:15px;">
                    <label style="display:block;">
                        <span style="display:block; margin-bottom:5px; font-weight:500;">E-post *</span>
                        <input type="email" id="contact-email" required placeholder="navn@skole.no" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:6px;">
                    </label>
                    
                    <label style="display:block;">
                        <span style="display:block; margin-bottom:5px; font-weight:500;">Telefon *</span>
                        <input type="tel" id="contact-phone" required placeholder="8 siffer" pattern="[0-9]{8}" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:6px;">
                    </label>
                </div>
                
                <label style="display:block; margin-bottom:15px;">
                    <span style="display:block; margin-bottom:5px; font-weight:500;">Antall lÃ¦rere *</span>
                    <select id="teacher-count" required style="width:100%; padding:10px; border:1px solid #ddd; border-radius:6px;">
                        <option value="">Velg...</option>
                        <option value="1-5">1-5 lÃ¦rere</option>
                        <option value="6-15">6-15 lÃ¦rere</option>
                        <option value="16+">16+ lÃ¦rere</option>
                    </select>
                </label>
                
                <label style="display:block; margin-bottom:20px;">
                    <span style="display:block; margin-bottom:5px; font-weight:500;">Melding (valgfritt)</span>
                    <textarea id="school-message" rows="3" placeholder="Har dere spÃ¸rsmÃ¥l eller spesielle behov?" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:6px; resize:vertical;"></textarea>
                </label>
                
                <button type="submit" class="btn-primary" style="width:100%; padding:12px; font-size:16px;">
                    Send forespÃ¸rsel
                </button>
            </form>
        </div>
    </div>

</body>
</html>